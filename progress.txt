# Progress Log (append-only)

---
## Known Issues / Runbook
---

### Active Issues
<!-- Format:
- [ ] (YYYY-MM-DD) <title>
  - Symptoms:
  - Repro:
  - Suspected cause:
  - Next step:
-->

### Resolved Issues
<!-- Format:
- [x] (YYYY-MM-DD) <title> — fixed in <commit hash>
-->

### Runbook (common failures)

**Verify fails because DB isn't ready**
- Check: `docker compose ps`
- Check readiness: `docker compose exec -T db pg_isready -U monenete`
- If stuck: `docker compose logs db --tail=200`

**E2E replay fails**
- Look at: `logs/iter_*.verify.txt`
- Confirm replay file exists: `data/replay/events.jsonl`
- Confirm fixtures exist: `data/fixtures/bags/*.json` and `data/fixtures/non_bags_dbc/*.json`

**Signature gate fails (false positives)**
- Use manual checker:
  - `bun run sig:check data/fixtures/bags/<file>.json`
  - `bun run sig:check data/fixtures/non_bags_dbc/<file>.json`
- Add a fixture that reproduces the failure, then tighten classifier rules.

**Loop thrashing / no progress**
- Check: `logs/iter_*.diffstat.txt`
- Add a smaller next step into `IMPLEMENTATION_PLAN.md`
- Document blocker in `BLOCKERS.md` if truly stuck.

---
## Historical Context (pre-Ralph)
---

### 2026-01-27: Project Kickoff

Created Bags.fm signal aggregation bot plan.

**Key decisions:**
- Target Bags.fm (not pump.fun) — less competition, uses Meteora DBC
- Phased approach with gates — no capital until validated
- EV-based scoring, not win rate
- Research first, then code

**Key insights:**
1. Bags uses shared infra (Meteora DBC/DAMM) — program ID alone won't work
2. Leaderboard wallets are dirty — filter deployers/snipers
3. "2x in 24h" misleading — need realistic latency simulation
4. Track exit success rate, not just entries
5. Quote-based sizing, not liquidity estimates

**Architecture (7 components):**
A: Ingestion → B: Normalizer → C: Signature decoder → D: Quote service → E: Wallet analytics → F: Strategy → G: Execution

**Stack:** Bun + TypeScript + Postgres (Neon)

---

### 2026-01-27: API Verification + Key Discovery

**Critical discovery — Fee Share V1 is the Bags differentiator:**
- DBC program = shared Meteora infra, used by many platforms
- Fee Share V1 (`FEEhPbKVKnco9EXnaY3i4R5rQVUx91wgVfu8qokixywi`) = Bags-specific
- Fee Share V2 appears unused

**Signature formula:**
```
Bags launch = Fee Share V1 + DBC program in same tx
```

**Token collection strategy:**
- Cannot use Bags API to list tokens (no endpoint)
- Must monitor Fee Share V1 program on-chain to discover Bags launches

---

### 2026-01-27: Metrics Decision

**Chose Axiom over Grafana/Prometheus:**
- No infra to manage, 500GB/month free
- Circuit breakers stay in-memory (need <10ms)
- Trade journal in Postgres (backtesting)
- Metrics/dashboards in Axiom

---

### 2026-01-27: Ralph Harness Setup

- Created E2E Ralph harness with component specs
- Consolidated docs: single source of truth for contract and plan
- Removed deprecated files

---
## Ralph Iterations
---

### Journal Format Template
```
## Iteration N (YYYY-MM-DD HH:MM)
**Task**: [copied from TODO]
**Actions**: [what you did]
**Verification**: [command + result]
**Next**: [next unchecked item]
```

<!-- Agent appends iteration notes below -->

## Iteration 3
**Gate**: migrations
**Error**: migrate.ts was a stub - printed migrations but exited with code 1 without actually running them
**Fix**: Implemented actual Postgres connection using the `postgres` package (already in dependencies). Script now connects to local docker DB (monenete/monenete@localhost:5432) and runs all 10 migrations (7 tables + 3 indexes).
**Result**: PASS

## Iteration 4
**Gate**: fixtures_bags_count
**Error**: have 0, need 10
**Fix**: Created `scripts/collect-bags.ts` to fetch real Bags launch transactions from Helius API. The script queries the Fee Share V1 program (`FEEhPbKVKnco9EXnaY3i4R5rQVUx91wgVfu8qokixywi`) for transaction signatures, fetches full transaction data, and filters for transactions that also contain the Meteora DBC program. Collected 10 real Bags launch transactions as fixtures in `data/fixtures/bags/bags_01.json` through `bags_10.json`.
**Result**: PASS

