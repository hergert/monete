# Progress Log

## Current Status: PIVOT TO HISTORICAL BACKTEST

### Direction (2026-01-28)

**Problem identified:** Live monitoring works but is inefficient for validation.
- 60s of monitoring = 44 detections, only 2 BAGS trades
- Waiting for sell signals to calculate P&L could take days
- Sample size too small (2 wallets, ~3 trades each)

**Evidence from live testing:**
- Detection latency: 1.4s avg (source: reports/live_monitor.json)
- Price fetch adds: ~1s (source: live-monitor.ts logs)
- Total delay before we could execute: ~2.5s

**Gap vs PLAN.md requirements:**
- Plan requires: "≥15 wallets with EV lower bound >0, each with ≥20 signals"
- We have: 2 wallets with 3 trades each
- Plan requires: "After 10 days: calculate per-wallet EV"
- We can simulate this NOW with historical data

**New direction:** Historical backtest simulation
1. Get historical Bags trades for our wallets via Birdeye
2. Simulate entry at (wallet_buy_time + 2.5s delay)
3. Simulate exit at (wallet_sell_time + 2.5s delay)
4. Calculate P&L after 0.6% round-trip fees
5. Compare to baseline (random Bags token performance)

**Why this is better:**
- Immediate answer vs waiting days
- Larger sample size (all historical trades)
- Can test different latency assumptions
- Matches PLAN.md Phase 0B: "realistic simulation"

---

### Backtest Results (2026-01-28)

**Parameters:**
- Detection latency: 1400ms (from live testing)
- Price fetch latency: 1000ms (from live testing)
- Total delay: 2400ms
- Round-trip fees: 0.6%

**Results:**
- Total simulated trades: 4
- Closed trades: 1
- Open positions: 3

**P&L (closed trade):**
- Our P&L after fees: **-1.06%**
- Win rate: **0%**

**Open positions (unrealized):**
- ehipS3kn9GUS...BAGS: -0.03%
- H5hygVvXiYxk...BAGS: -2.70%
- 5arEQv5tGJj8...BAGS: -0.47%

**VERDICT: ❌ NEGATIVE EXPECTED VALUE**

Following these wallets with 2.4s latency produces negative returns after fees.
This confirms PLAN.md warning: "Smart money convergence collapses when latency erases alpha"

**Root causes:**
1. Sample size too small (4 trades)
2. Latency (2.4s) may be erasing edge
3. These wallets may not be the right signal source

**Next options:**
A. Find more/better wallets (Birdeye top traders API)
B. Reduce latency (faster infra, but costs money)
C. Different strategy (not copy trading)

---

### Methods Used (Reference)

**1. Wallet Discovery (src/birdeye-deep-analysis.ts)**
- Fetched trades per Bags token via Birdeye `/defi/txs/token`
- Grouped by wallet, calculated buy/sell totals
- Filtered: ≥3 trades, ≥2 tokens, positive P&L, <500% P&L
- Result: 2 eligible wallets from 187 total

**2. Wallet Validation (src/validate-wallets.ts)**
- Checked if wallet deployed tokens (Helius tx history)
- Checked sniper patterns (buy latency from launch)
- Checked deployer relationships
- Result: Both wallets SAFE (not insiders)

**3. Live Monitoring (src/live-monitor.ts)**
- Helius WebSocket `logsSubscribe` for wallet activity
- Parse transactions via Helius `/v0/transactions`
- Detect BAGS tokens (mint ends in "BAGS")
- Capture entry price via Birdeye `/defi/price`
- Measured latency: 1.4s detection + 1s price fetch = 2.4s total

**4. Historical Backtest (src/historical-backtest.ts)**
- Get wallet's historical trades per token
- Get OHLCV data to estimate price at (wallet_time + latency)
- Calculate P&L with fees
- Result: -1.06% avg (negative EV)

**Key Learning:**
The wallets we found are "fast traders" - they buy and sell quickly.
With 2.4s latency, we enter AFTER they've already moved the price.
We need wallets that HOLD longer, so our delay matters less.

**Wallet Quality Criteria (Updated):**
- Hold time: entry→exit > 5 minutes (latency-tolerant)
- Multi-token: traded ≥3 different Bags tokens (not insider)
- Consistent: positive P&L across multiple tokens (not luck)
- Active: ≥10 Bags trades total (statistical significance)

---

### Slow Trader Search Results (2026-01-28)

**Method:** src/find-slow-traders.ts
- Analyzed 11 Bags tokens
- Collected 550 trades from Birdeye
- Found 292 unique wallets
- 52 wallets had completed buy→sell round trips

**Shocking finding:**
ALL 52 wallets with round trips show **0% realized P&L**

**Interpretation:**
1. Data issue: Birdeye `volumeUSD` may not reflect actual P&L
2. OR: These Bags tokens are genuinely zero-sum / unprofitable
3. OR: Sample is too small (only 50 trades per token)

**Key wallets examined:**
- 5zf7uryG7jXM (our original): 3 tokens, 56min hold, 0% P&L
- 9LGjXs2u3c9s: 3 tokens, 155h hold, 0% P&L
- 3i51cKbLbaKA: 3 tokens, 15h hold, 0% P&L

**Root question unanswered:**
Does ANYONE make money trading Bags tokens consistently?
If the baseline is 0% or negative, copy trading cannot work.

**Next step needed:**
Establish baseline - what is the average return of buying a random Bags token?
If baseline is negative, the entire strategy is flawed.

---

### Live Validation Results (2026-01-28)

**Wallets Validated:**
- 5zf7uryG7jXMEnKvSM2WmmHcJu3Q2fXBpUjZkE7XC2Xr (45.9% P&L) - SAFE
- gasTzr94Pmp4Gf8vknQnqxeYxdgwFjbgdJa4msYRpnB (18.0% P&L) - SAFE

**Insider Check:** PASSED
- Neither wallet is a token deployer
- No sniper bot patterns detected
- No deployer relationships found

**Live Monitor Results (30 second test):**
- Total detections: 28 transactions
- Avg latency: 1,389ms (from block time to detection)
- Min latency: 928ms
- Max latency: 1,815ms
- Active trading via Jupiter
- Includes DAMM v2 (migrated Bags tokens)

**Paper Trades Captured:**
- `k9BKDF8x9Y6nBbGVL938yPT33h4zo8p8GTsi4wJBAGS` - latency 1756ms
- `CdyjsXbPs6VamxNk7StU5apXFHAiM7q8FTYAN3rdBAGS` - latency 1815ms

**Key Insight:**
- ~1.4 second average latency = ~3-4 Solana slots behind
- Bags token trades successfully detected and logged
- System is ready for paper trading phase

### What's Working (Real, Validated)

1. **Signature Detection**: PASS (0% FP rate)
   - Fee Share V1 + DBC program = Bags launch
   - bags_signature_v1.json artifact generated
   - Tested against 10 Bags + 20 non-Bags fixtures

2. **DBC SDK Integration**: WORKING
   - Can query pool state by mint
   - Can get current prices from sqrtPrice
   - Can detect migration status (all 7 test tokens have migrated to DAMM)
   - Can get swap quotes for pre-migration tokens
   - Code: src/dbc-client.ts

3. **Helius Wallet Analysis**: WORKING
   - Can discover traders from token transactions
   - Can parse swap events (buy/sell with amounts)
   - Can calculate P&L from on-chain data
   - Found 121 unique traders across 7 Bags tokens
   - Code: src/helius-wallet-analyzer.ts, src/discover-traders.ts

4. **Database**: PASS
   - 7 tables created via migrations
   - Dedupe constraint working

5. **Birdeye Integration**: WORKING
   - API key configured
   - Can fetch token trades with buy/sell/USD amounts
   - Rate limiting working (2s between requests)
   - Code: src/birdeye-deep-analysis.ts

### Current Gate Status

**Phase 0B Gate: Wallet EV Calculation**
- Gate requires: ≥15 wallets with positive P&L, multi-token, ≥3 trades
- Current status: **2 eligible wallets found**
- Eligible wallets:
  - 5zf7uryG7jXM: 45.9% P&L, 3 trades, 2 tokens
  - gasTzr94Pmp4: 18.0% P&L, 3 trades, 2 tokens
- Analysis summary: 187 wallets, 67 with buys, 7 with profits
- Root cause of gap: Only 7 Bags tokens analyzed
- Solution: Discover more Bags tokens to analyze

### What We Learned

1. **All our Bags tokens have migrated to DAMM**
   - isMigrated=1, migrationProgress=3 (CreatedPool)
   - Jupiter NO_ROUTE was for DBC pools; DAMM pools have liquidity
   - For live trading: use Jupiter for migrated, DBC SDK for pre-migration

2. **Scale problem with current approach**
   - 121 traders found, but most have <3 trades in our specific tokens
   - Need either: (a) more Bags tokens, or (b) Birdeye for pre-computed P&L

3. **Birdeye has what we need**
   - Historical OHLCV for any token including DBC
   - Wallet P&L API with realized/unrealized profit
   - Top traders per token
   - Free tier: 30k requests/month (sufficient for validation)

### Next Steps

1. **Paper Trading Phase** - CURRENT
   - Run live-monitor.ts continuously
   - Track detected swaps and simulate entry
   - Measure slippage from signal to execution
   - Calculate real edge after fees

2. **If paper trading shows edge > 2%:**
   - Build actual execution (Jupiter swap)
   - Start with minimal position sizes ($10-50)
   - Scale based on results

3. **If paper trading shows no edge:**
   - Wallets might be front-running us (we detect them too late)
   - Need faster infrastructure (dedicated RPC, co-location)
   - Or find different signal source

### What We Proved

- The methodology works: Found 2 real profitable wallets
- Birdeye data is accurate and usable
- Buy/sell detection and P&L calculation working correctly
- Just need more data volume

### Files Created This Session

- src/dbc-client.ts - DBC SDK wrapper, pool queries, swap quotes
- src/dbc-debug.ts - Debug script for pool structure
- src/birdeye-client.ts - Birdeye API client (needs API key)
- src/helius-wallet-analyzer.ts - Parse wallet trading history
- src/discover-traders.ts - Find and profile Bags traders
- reports/trader_discovery.json - Results of trader analysis

### Key Insights for Strategy

1. **Pre-migration vs Post-migration**
   - Pre-migration: Trade on DBC bonding curve directly
   - Post-migration: Trade via Jupiter/DAMM
   - Detection: Check pool.isMigrated and pool.migrationProgress

2. **Signal source should be Birdeye top traders**
   - More efficient than parsing all txs ourselves
   - Pre-computed P&L and performance metrics
   - Rate limited to 5 rps for wallet APIs

3. **EV calculation formula**
   ```
   per_token_pnl = (sell_sol - buy_sol) / buy_sol
   ev_mean = mean(per_token_pnls)
   ev_lower_bound = ev_mean - 1.96 * (std / sqrt(n))
   ```

---

## Historical Context

### Key Decisions (2026-01-27)
- Target Bags.fm (not pump.fun) — less competition, uses Meteora DBC
- Phased approach with gates — no capital until validated
- EV-based scoring, not win rate

### Previous Session (2026-01-27)
- Built fixture collection scripts
- Signature detection working
- E2E pipeline created (but with checkbox gaming issues)

### This Session (2026-01-28)
- Identified checkbox gaming problem
- Built real DBC SDK integration
- Built real wallet analysis pipeline
- Discovered scale problem (need more data)
- Identified Birdeye as solution

---

<!-- Gate check: 2/15 eligible wallets. Need more Bags tokens. -->
